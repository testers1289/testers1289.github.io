<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Login</title>
    <link rel="stylesheet" href="/style.css">
  </head>
  <body>
    <main style="padding:24px;max-width:600px;margin:40px auto;background:rgba(255,255,255,0.02);border-radius:8px;">
      <h2>Login / Register</h2>
      <input id="login-username" placeholder="username" />
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="btn-register">Register</button>
        <button id="btn-login">Login</button>
        <button id="btn-logout">Logout</button>
      </div>
      <p style="color:var(--muted);margin-top:12px">This demo uses username-only auth and stores sessions in data.json. No passwords.</p>
      <p><a href="/">Back to app</a></p>
    </main>
    <script>
      const API_BASE = window.API_BASE || '';
      async function req(path, opts){
        const res = await fetch(API_BASE + path, Object.assign({credentials:'include'}, opts));
        return res;
      }
      document.getElementById('btn-register').addEventListener('click', async () => {
        const u = document.getElementById('login-username').value.trim();
        if (!u) return alert('username');
        const r = await req('/api/register', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ username: u }) });
        if (r.ok) alert('registered'); else alert('failed');
      });
      document.getElementById('btn-login').addEventListener('click', async () => {
        const u = document.getElementById('login-username').value.trim();
        if (!u) return alert('username');
        const r = await req('/api/login', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ username: u }) });
        if (r.ok) location.href = '/'; else alert('login failed');
      });
      document.getElementById('btn-logout').addEventListener('click', async () => {
        await req('/api/logout', { method:'POST' });
        alert('logged out');
      });
    </script>
  </body>
</html>
